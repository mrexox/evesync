#!/usr/bin/env ruby
# -*- mode: ruby -*-

require 'sysmoon/distro'
require 'sysmoon/handlers'

# TODO: puts -> logging
puts "sysmoond starting!"

pkg_que = Queue.new

threads = []

threads << Thread.new { PackageWatcher.new(pkg_que).run }

threads << Thread.new { PackageHandler.new(pkg_que).run }

puts "sysmoond started!"

Signal.trap("TERM") do
  puts "sysmoond killed..."
  threads.each { |thr| thr.exit }
  exit(0)
end

Signal.trap("SIGINT") do
  puts "sysmoond interrupted..."
  threads.each { |thr| thr.exit }
  exit(1)
end

loop do
  sleep 100
end
