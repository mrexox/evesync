#!/usr/bin/env ruby
# -*- mode: ruby -*-

require 'sysmoon/distro'

puts "sysmoond starting!"

pw_que = Queue.new

pw_thr = Thread.new { PackageWatcher.new(pw_que).run }

ph_thr = Thread.new do
  loop do
    package = pw_que.pop
    puts "Value #{package.name}-#{package.version}"
  end
end

threads = [pw_thr, ph_thr]

puts "sysmoond started!"

Signal.trap("TERM") do
  puts "sysmoond killed..."
  threads.each { |thr| thr.exit }
  exit(0)
end

Signal.trap("SIGINT") do
  puts "sysmoond interrupted..."
  threads.each { |thr| thr.exit }
  exit(1)
end
